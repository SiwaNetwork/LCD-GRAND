# Инструкция по подключению 1.54 inch LCD GAME к CM4

## Обзор

Данная инструкция описывает подключение 1.54 inch LCD GAME дисплея с контроллером ST7789 к Raspberry Pi CM4 через 40PIN гребенку.

## Компоненты

- 1.54 inch LCD GAME дисплей (ST7789)
- Raspberry Pi CM4
- 40PIN гребенка
- Соединительные провода
- Источник питания 3.3V

## Характеристики дисплея

- **Разрешение**: 240x240 пикселей
- **Контроллер**: ST7789
- **Интерфейс**: SPI
- **Напряжение питания**: 3.3V
- **Размер**: 1.54 inch
- **Цветовая глубина**: 16-bit (RGB565)

## Схема подключения

### Таблица подключения 40PIN

| LCD Pin | CM4 Pin | Функция | Описание |
|---------|---------|---------|----------|
| VCC     | 3.3V    | Питание | Напряжение питания 3.3V |
| GND     | GND     | Земля   | Общий провод |
| SCL     | GPIO 11 | SPI SCLK | Тактовый сигнал SPI |
| SDA     | GPIO 10 | SPI MOSI | Данные от CM4 к дисплею |
| RES     | GPIO 25 | Reset | Сброс дисплея |
| DC      | GPIO 24 | Data/Command | Выбор режима данных/команд |
| CS      | GPIO 8  | Chip Select | Выбор чипа |
| BLK     | GPIO 18 | Backlight | Управление подсветкой |

### Детальная схема

```
LCD Display (1.54 inch)     Raspberry Pi CM4
┌─────────────┐             ┌─────────────┐
│             │             │             │
│ VCC ────────┼─────────────┼─ 3.3V      │
│             │             │             │
│ GND ────────┼─────────────┼─ GND       │
│             │             │             │
│ SCL ────────┼─────────────┼─ GPIO 11   │
│             │             │             │
│ SDA ────────┼─────────────┼─ GPIO 10   │
│             │             │             │
│ RES ────────┼─────────────┼─ GPIO 25   │
│             │             │             │
│ DC ─────────┼─────────────┼─ GPIO 24   │
│             │             │             │
│ CS ─────────┼─────────────┼─ GPIO 8    │
│             │             │             │
│ BLK ────────┼─────────────┼─ GPIO 18   │
│             │             │             │
└─────────────┘             └─────────────┘
```

## Пошаговая инструкция

### Шаг 1: Подготовка компонентов

1. Убедитесь, что у вас есть все необходимые компоненты
2. Проверьте целостность дисплея и проводов
3. Подготовьте рабочую поверхность

### Шаг 2: Отключение питания

1. Убедитесь, что CM4 отключен от питания
2. Отключите все периферийные устройства

### Шаг 3: Подключение питания

1. Подключите VCC дисплея к 3.3V CM4
2. Подключите GND дисплея к GND CM4
3. Проверьте надежность соединений

### Шаг 4: Подключение SPI интерфейса

1. Подключите SCL (GPIO 11) - тактовый сигнал
2. Подключите SDA (GPIO 10) - данные
3. Подключите CS (GPIO 8) - выбор чипа
4. Подключите DC (GPIO 24) - режим данных/команд

### Шаг 5: Подключение управления

1. Подключите RES (GPIO 25) - сброс дисплея
2. Подключите BLK (GPIO 18) - управление подсветкой

### Шаг 6: Проверка подключения

1. Визуально проверьте все соединения
2. Убедитесь в отсутствии коротких замыканий
3. Проверьте правильность подключения полярности

## Настройка системы

### Включение SPI интерфейса

1. Откройте терминал на CM4
2. Выполните команду:
   ```bash
   sudo raspi-config
   ```
3. Перейдите в "Interface Options"
4. Выберите "SPI"
5. Включите SPI интерфейс
6. Перезагрузите систему

### Проверка SPI

```bash
# Проверка доступности SPI
ls /dev/spidev*

# Должно показать:
# /dev/spidev0.0
# /dev/spidev0.1
```

### Установка драйвера

```bash
# Клонирование репозитория
git clone <repository-url>
cd cm4-lcd-game-driver

# Установка драйвера
sudo ./install.sh
```

## Тестирование

### Базовый тест

```bash
# Запуск тестового скрипта
sudo python3 test_display.py
```

### Демонстрация возможностей

```bash
# Запуск демонстрации
sudo python3 examples/demo.py
```

### Игровой тест

```bash
# Запуск игры "Змейка"
sudo python3 examples/snake_game.py
```

## Устранение неполадок

### Дисплей не включается

1. **Проверьте питание**:
   - Убедитесь, что VCC подключен к 3.3V
   - Проверьте напряжение мультиметром

2. **Проверьте SPI**:
   ```bash
   dmesg | grep spi
   ```

3. **Проверьте права доступа**:
   ```bash
   sudo usermod -a -G spi $USER
   ```

### Нет изображения

1. **Проверьте подключение пинов**:
   - SCL, SDA, RES, DC, CS должны быть подключены правильно
   - Проверьте целостность проводов

2. **Проверьте драйвер**:
   ```bash
   sudo systemctl status lcd-game
   ```

3. **Проверьте логи**:
   ```bash
   sudo journalctl -u lcd-game -f
   ```

### Медленная работа

1. **Проверьте скорость SPI**:
   - Уменьшите скорость в config.py
   - Проверьте качество соединений

2. **Оптимизируйте код**:
   - Используйте аппаратное ускорение
   - Уменьшите частоту обновления

### Проблемы с цветами

1. **Проверьте инициализацию**:
   - Убедитесь, что команды ST7789 выполняются правильно
   - Проверьте настройки цветового пространства

2. **Калибровка**:
   - Настройте гамма-коррекцию
   - Проверьте яркость и контрастность

## Дополнительные настройки

### Настройка автозапуска

```bash
# Включение автозапуска сервиса
sudo systemctl enable lcd-game

# Проверка статуса
sudo systemctl status lcd-game
```

### Настройка производительности

Отредактируйте файл `/etc/lcd_game.conf`:

```ini
[performance]
fps = 30
buffer_size = 1024
dma_enabled = true
```

### Настройка энергосбережения

```ini
[power]
backlight_timeout = 300
sleep_timeout = 600
auto_brightness = true
```

## Безопасность

1. **Электростатическая защита**:
   - Используйте антистатический браслет
   - Работайте на антистатической поверхности

2. **Тепловой режим**:
   - Не превышайте максимальную температуру дисплея
   - Обеспечьте вентиляцию

3. **Механическая защита**:
   - Защитите дисплей от ударов
   - Используйте защитное стекло при необходимости

## Техническая поддержка

При возникновении проблем:

1. Проверьте раздел "Устранение неполадок"
2. Обратитесь к документации
3. Создайте issue в репозитории
4. Обратитесь к сообществу

## Ссылки

- [Документация ST7789](https://www.sitronix.com.tw/sitronix/product.nsf/resource/ST7789)
- [Raspberry Pi GPIO](https://www.raspberrypi.org/documentation/usage/gpio/)
- [SPI интерфейс](https://www.raspberrypi.org/documentation/hardware/raspberrypi/spi/)